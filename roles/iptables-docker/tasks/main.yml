---
- name: Populate service facts
  ansible.builtin.service_facts:
- name: Include iptables-legacy tasks
  ansible.builtin.include_tasks:
    file: iptables-legacy.yml
    apply:
      tags: iptables-legacy,legacy
  tags: iptables-legacy,legacy

# Not all Debian flavors install gawk by default
# I found several of my servers that had mawk, but
# when you install gawk on Debian it manipulates
# update-alternatives to use gawk as awk, I have
# made a TODO item on my list to harden this check
- name: Ensure gawk pacakge is installed
  ansible.builtin.package:
    name: gawk
    state: present

- name: Include install tasks
  ansible.builtin.include_tasks:
    file: install.yml
    apply:
      tags: iptables-install,install
  tags: iptables-install,install
  when: iptables_docker_uninstall is false

- name: Include uninstall tasks
  ansible.builtin.include_tasks:
    file: uninstall.yml
    apply:
      tags: uninstall-install,uninstall
  tags: uninstall-install,uninstall
  when: iptables_docker_uninstall is true
